% thesis.sty – Custom style for Master's thesis
% Lucas — UCT Computational Logic
% ------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{macros/thesis}[2025/03/30 Master's Thesis Style]

% ------------------------------------------------------------------
% Subfile support and local macros
% ------------------------------------------------------------------
\usepackage{subfiles} % allows splitting thesis into subfiles
\input{macros/formal-concept-analysis.tex}
\input{macros/general.tex}
\input{macros/fca.sty}

% ------------------------------------------------------------------
% Encoding and Language
% ------------------------------------------------------------------
\usepackage[english]{babel}
\usepackage{microtype}     % typographic refinements
\usepackage{dirtytalk}     % for quotations: \say{...}
\usepackage{csquotes}      % recommended for quotes and biblatex

% ------------------------------------------------------------------
% Fonts
% ------------------------------------------------------------------
\usepackage{mathtools}
\RequirePackage{stix2}               % main text + math font
\usepackage[scaled=0.9]{inconsolata} % monospaced font for code

% ------------------------------------------------------------------
% Page Geometry and Spacing
% ------------------------------------------------------------------
\usepackage{geometry}
\geometry{
 a4paper,
 left=1in,
 right=1in,
 top=1in,
 headsep=0.25in,
}
\usepackage{setspace}
\setstretch{1.25}            % line spacing
\setlength{\parskip}{0.3em}  % paragraph spacing
\setlength{\parindent}{15pt} % paragraph indentation

% ------------------------------------------------------------------
\usepackage{titlesec}

% Example: make section headings slightly smaller
\titleformat{\section}
  {\normalfont\bfseries\fontsize{0.9\baselineskip}{1.1\baselineskip}\selectfont}
  {\thesection}{1em}{}

% ------------------------------------------------------------------
% Headers and footers
% ------------------------------------------------------------------
\RequirePackage{fancyhdr}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter\ : #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ : #1}}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[EL]{\textit{\small Section \rightmark}}    % section name (even, left)
\fancyhead[ER]{\textit{\small \thepage}}              % page number (even, right)
\fancyhead[OL]{\textit{\small \thepage}}              % page number (odd, left)
\fancyhead[OR]{\textit{\small Chapter \leftmark}}     % chapter name (odd, right)
\renewcommand{\headrulewidth}{0.4pt}
\fancypagestyle{plain}{        % plain pages (e.g., chapter openings)
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

% ------------------------------------------------------------------
% Lists
% ------------------------------------------------------------------
\usepackage{enumitem}

% ------------------------------------------------------------------
% Math and theorem environments
% ------------------------------------------------------------------
\usepackage{amsmath,amsthm,amssymb}
\usepackage{thmtools}
\usepackage{epigraph}
\everymath{\displaystyle} % force displaystyle in inline math

% redefine large operators to be less vertically inflated
\let\origbigvee\bigvee
\renewcommand{\bigvee}{\textstyle\mathop{\origbigvee}}
\let\origbigwedge\bigwedge
\renewcommand{\bigwedge}{\textstyle\mathop{\origbigwedge}}
\let\origbigcup\bigcup
\renewcommand{\bigcup}{\textstyle\mathop{\origbigcup}}
\let\origbigcap\bigcap
\renewcommand{\bigcap}{\textstyle\mathop{\origbigcap}}

% Theorem declarations
\declaretheorem[style=plain]{theorem}
\declaretheorem[style=plain]{example}
\AtEndEnvironment{example}{\par\addvspace{\baselineskip}}
\declaretheorem[style=definition]{definition}
\declaretheorem[style=remark]{remark}
\declaretheorem{lemma}
\declaretheorem{proposition}
\declaretheorem{corollary}

% ------------------------------------------------------------------
% Figures and floats
% ------------------------------------------------------------------
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{listings}      % for code (but pseudocode uses algpseudocode)
\usepackage[table,dvipsnames]{xcolor}
\usepackage{tikz}
\usetikzlibrary{positioning,calc,fit,shapes.geometric,patterns,intersections}
\usepackage{pst-node,pst-plot}

% ------------------------------------------------------------------
% Colours
% ------------------------------------------------------------------
\definecolor{blue}{HTML}{0000A4}
\definecolor{green}{HTML}{025C5D}
\definecolor{red}{HTML}{C30A18}
\definecolor{mediumblue}{rgb}{0.173,0.498,0.722}
\definecolor{darkblue}{rgb}{0.145,0.204,0.580}

% ------------------------------------------------------------------
% Hyperlinks and cross-references
% ------------------------------------------------------------------
\usepackage[colorlinks=true,linkcolor=blue,citecolor=darkblue,urlcolor=blue]{hyperref}
\usepackage[nameinlink]{cleveref}
\usepackage{url}
\crefname{figure}{figure}{figures}
\Crefname{figure}{Figure}{Figures}
\crefname{subfigure}{subfigure}{subfigures}
\Crefname{subfigure}{Subfigure}{Subfigures}
\crefname{section}{section}{sections}
\Crefname{section}{Section}{Sections}
\crefname{subsection}{subsection}{subsections}
\Crefname{subsection}{Subsection}{Subsections}
\Crefname{cxt}{Formal Context}{Formal Contexts}

% ------------------------------------------------------------------
% Index
% ------------------------------------------------------------------
\usepackage{makeidx}
\makeindex

% ------------------------------------------------------------------
% Citation Style (IJCAI-like, square brackets)
% ------------------------------------------------------------------
\makeatletter
\def\leftcite{\@up[}
\def\rightcite{\@up]}
\def\cite{\def\citeauthoryear##1##2{\def\@thisauthor{##1}%
             \ifx \@lastauthor \@thisauthor \relax \else##1, \fi ##2}\@icite}
\def\shortcite{\def\citeauthoryear##1##2{##2}\@icite}
\def\citeauthor{\def\citeauthoryear##1##2{##1}\@nbcite}
\def\citeyear{\def\citeauthoryear##1##2{##2}\@nbcite}
\def\@icite{\leavevmode\def\@citeseppen{-1000}%
 \def\@cite##1##2{\leftcite\nobreak\hskip 0in{##1\if@tempswa , ##2\fi}\rightcite}%
 \@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}}
\def\@nbcite{\leavevmode\def\@citeseppen{1000}%
 \def\@cite##1##2{{##1\if@tempswa , ##2\fi}}%
 \@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}}
\def\@citex[#1]#2{%
  \def\@lastauthor{}\def\@citea{}%
  \@cite{\@for\@citeb:=#2\do
    {\@citea\def\@citea{;\penalty\@citeseppen\ }%
     \if@filesw\immediate\write\@auxout{\string\citation{\@citeb}}\fi
     \@ifundefined{b@\@citeb}{\def\@thisauthor{}{\bf ?}\@warning
       {Citation `\@citeb' on page \thepage \space undefined}}%
     {\csname b@\@citeb\endcsname}\let\@lastauthor\@thisauthor}}{#1}}
\def\@biblabel#1{\def\citeauthoryear##1##2{##1, ##2}\@up{[}#1\@up{]}\hfill}
\def\@up#1{\leavevmode\raise.2ex\hbox{#1}}
\makeatother

% ------------------------------------------------------------------
% Custom commands for metadata
% ------------------------------------------------------------------
\newcommand{\thetitle}{}
\newcommand{\theauthor}{}
\newcommand{\thedate}{}
\renewcommand{\title}[1]{\renewcommand{\thetitle}{#1}}
\renewcommand{\author}[1]{\renewcommand{\theauthor}{#1}}
\renewcommand{\date}[1]{\renewcommand{\thedate}{#1}}

% ------------------------------------------------------------------
% Counters and ToC depth
% ------------------------------------------------------------------
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

% ------------------------------------------------------------------
% Hilbert-style proofs
% ------------------------------------------------------------------
\usepackage{proof}
\newcounter{proofHstep}
\newenvironment{proofH}[1][Proof]{%
  \par\smallskip\noindent\textit{#1.\\}  % default heading “Proof.”
  \setcounter{proofHstep}{0}%
  \ignorespaces
}{%
  \par\smallskip\qed
}
\newcommand{\Hstep}[2][]{%
  \refstepcounter{proofHstep}%
  \noindent\makebox[2.1em][r]{\bfseries\arabic{proofHstep}.}\,
  $#2$%
  \ifstrempty{#1}{}{%
    \hfill(\text{#1})%
  }%
  \par
}
\newcommand{\inferLeft}[3]{
\text{(#1)} \quad &
\begin{array}{c}
#2 \\
\hline
#3
\end{array}
}
\newcommand{\inferLeftNoLabel}[2]{
\begin{array}{c}
#1 \\
\hline
#2
\end{array}
}

% ------------------------------------------------------------------
% Algorithms and pseudocode
% ------------------------------------------------------------------
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{refcount}

\newcommand{\linelabel}[1]{%
  \refstepcounter{ALC@line}\label{#1}%
  \addtocounter{ALC@line}{-1}%
}

% Customise algorithmic keywords
\algrenewcommand\algorithmicrequire{\textbf{Input:}}
\algrenewcommand\algorithmicensure{\textbf{Output:}}
\algrenewcommand\alglinenumber[1]{\scriptsize #1} % smaller line numbers
\algrenewcommand\algorithmiccomment[1]{\hfill\(\triangleright\) #1}

% Convenient wrapper: algo environment
% Usage: \begin{algo}{Caption} ... \end{algo}
\newenvironment{algo}[2][htbp]
  {\begin{algorithm}[#1]
   \caption{#2}
   \begin{algorithmic}[1]} % numbered lines
  {\end{algorithmic}
   \end{algorithm}}

% ------------------------------------------------------------------
% Commonly used symbols
% ------------------------------------------------------------------
\newcommand{\pset}[1]{\mathfrak{P}({#1})}
\newcommand{\tiff}{\quad \text{if and only if}\quad}
\newcommand{\tand}{\; \text{and} \;}
\newcommand{\timpl}{\quad \text{implies} \quad}
\newcommand{\pin}{\mathcal{W}}
\newcommand{\Pin}{\mathcal{W} = \langle S,l,\prec \rangle}
\newcommand{\lang}{\mathcal{L}}
\newcommand{\Lang}{\mathcal{L}_+}
\newcommand{\Cn}[1]{\mathcal{C}n_{#1}}
\newcommand{\Ca}[1]{C(#1)}
\newcommand{\cl}[2]{\mathsf{cl}_{#1}({#2})}
