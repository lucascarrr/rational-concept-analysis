% thesis.sty – Custom style for Master's thesis
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{macros/thesis}[2025/03/30 Master's Thesis Style]

% --- Subfile support ---
\usepackage{subfiles}
\input{macros/formal-concept-analysis.tex}
\input{macros/general.tex}
\input{macros/fca.sty}

% --- Encoding and Language ---
% \usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{microtype}
\usepackage{dirtytalk}
\usepackage{csquotes}

\usepackage{mathtools}
\RequirePackage{stix2}
\usepackage[scaled=0.9]{inconsolata}

% --- Geometry and Spacing ---
\usepackage{geometry}
\geometry{
 a4paper,
 left=1in,
 right=1in,
 top=1in,
 headsep=0.25in,
 }
\usepackage{setspace}
\setstretch{1.25}
\setlength{\parskip}{0.3em}
\setlength{\parindent}{15pt}

\RequirePackage{fancyhdr}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter\ : #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ : #1}}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[EL]{\textit{\small Section \rightmark}}    % current SECTION on the left
\fancyhead[ER]{\textit{\small \thepage}}      % page number on the right
\fancyhead[OL]{\textit{\small \thepage}}      % page number on the left
\fancyhead[OR]{\textit{\small Chapter \leftmark}}     % current CHAPTER on the right
\fancyfoot{}                  % no footers
\renewcommand{\headrulewidth}{0.4pt}   % keep or adjust
\fancypagestyle{plain}{        % redefine the 'plain' pagestyle
  \fancyhf{}                   % clear header and footer
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
\usepackage{enumitem}
% \setlist[itemize]{itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt}
% \setlist[enumerate]{itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt}
% \setlength{\abovedisplayskip}{6pt}
% \setlength{\belowdisplayskip}{6pt}
% \setlength{\abovedisplayshortskip}{4pt}
% \setlength{\belowdisplayshortskip}{4pt}

% --- Math and theorem environments ---
\usepackage{amsmath,amsthm}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{nicefrac}
\usepackage{thmtools}
\usepackage{epigraph}
\everymath{\displaystyle}
\theoremstyle{definition}

% --- Theorem declarations ---
\usepackage{etoolbox}
\declaretheorem[style=plain]{theorem}
\declaretheorem[style=plain]{example}
\AtEndEnvironment{example}{\par\addvspace{\baselineskip}}
\declaretheorem[style=definition]{definition}
\declaretheorem[style=remark]{remark}
\declaretheorem{lemma}
\declaretheorem{proposition}
\declaretheorem{corollary}

% --- Figures and floats ---
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{listings}
\usepackage[table,dvipsnames]{xcolor}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{calc,fit,shapes.geometric,patterns}
\usetikzlibrary{intersections}
\usepackage{pst-node,pst-plot}

% --- Colours ---
\definecolor{blue}{HTML}{0000A4}
\definecolor{green}{HTML}{025C5D}
\definecolor{red}{HTML}{C30A18}
\definecolor{mediumblue}{rgb}{0.173,0.498,0.722}
\definecolor{darkblue}{rgb}{0.145,0.204,0.580}

% --- Hyperlinks ---
\usepackage[colorlinks=true,linkcolor=blue,citecolor=darkblue,urlcolor=blue]{hyperref}
\usepackage[nameinlink]{cleveref}
\usepackage{url}
\crefname{figure}{figure}{figures}
\Crefname{figure}{Figure}{Figures}
\crefname{subfigure}{subfigure}{subfigures}
\Crefname{subfigure}{Subfigure}{Subfigures}
\crefname{section}{section}{sections}
\Crefname{section}{Section}{Sections}
\crefname{subsection}{subsection}{Subsections}
\Crefname{subsection}{Subsection}{Subsections}
\Crefname{cxt}{Formal Context}{Formal Contexts}

\usepackage{makeidx}
\makeindex
\usepackage{csquotes}

% \usepackage[
%   backend=bibtex,
%   style=alphabetic,
%   citestyle=authoryear,
%   sorting=nyt,
%   maxnames=2,
%   giveninits=true,
%   labeldateparts=true
% ]{biblatex}
% \addbibresource{references.bib}

% % Switch () to [] everywhere
% \renewcommand{\mkbibparens}[1]{[#1]}

% % Add comma between author and year
% \renewcommand*{\nameyeardelim}{\addcomma\space}

% % Your existing commands
% \let\shortcite\citeyear
% \DeclareRobustCommand{\citeauthor}[1]{\textcite{#1}}
% \DeclareRobustCommand{\citeyear}[1]{\citeyearpar{#1}}
% \let\cite\parencite

% % Add labels to bibliography entries with proper wrapping
% \DeclareFieldFormat{labelnumberwidth}{\mkbibbrackets{#1}\addspace}
% \defbibenvironment{bibliography}
%   {\list
%      {\printtext[labelnumberwidth]{%
%         \printnames{labelname}%
%         \addcomma
%         \setunit{\printdelim{nameyeardelim}}%
%         \printfield{labelyear}%
%         \printfield{extrayear}}}
%      {\setlength{\labelwidth}{0pt}%
%       \setlength{\leftmargin}{0pt}%
%       \setlength{\itemindent}{0pt}%
%       \setlength{\labelsep}{\biblabelsep}%
%       \setlength{\itemsep}{\bibitemsep}%
%       \setlength{\parsep}{\bibparsep}}%
%       \renewcommand*{\makelabel}[1]{##1\hfill}}
%   {\endlist}
%   {\item}
%

\makeatletter
\def\leftcite{\@up[}\def\rightcite{\@up]}

\def\cite{\def\citeauthoryear##1##2{\def\@thisauthor{##1}%
             \ifx \@lastauthor \@thisauthor \relax \else##1, \fi ##2}\@icite}
\def\shortcite{\def\citeauthoryear##1##2{##2}\@icite}

\def\citeauthor{\def\citeauthoryear##1##2{##1}\@nbcite}
\def\citeyear{\def\citeauthoryear##1##2{##2}\@nbcite}

% internal macro for citations with [] and with breaks between citations
% used in \cite and \shortcite
\def\@icite{\leavevmode\def\@citeseppen{-1000}%
 \def\@cite##1##2{\leftcite\nobreak\hskip 0in{##1\if@tempswa , ##2\fi}\rightcite}%
 \@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}}
% internal macro for citations without [] and with no breaks
% used in \citeauthor and \citeyear
\def\@nbcite{\leavevmode\def\@citeseppen{1000}%
 \def\@cite##1##2{{##1\if@tempswa , ##2\fi}}%
 \@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}}

% don't box citations, separate with ; and a space
% also, make the penalty between citations a parameter,
% it may be a good place to break
\def\@citex[#1]#2{%
  \def\@lastauthor{}\def\@citea{}%
  \@cite{\@for\@citeb:=#2\do
    {\@citea\def\@citea{;\penalty\@citeseppen\ }%
     \if@filesw\immediate\write\@auxout{\string\citation{\@citeb}}\fi
     \@ifundefined{b@\@citeb}{\def\@thisauthor{}{\bf ?}\@warning
       {Citation `\@citeb' on page \thepage \space undefined}}%
     {\csname b@\@citeb\endcsname}\let\@lastauthor\@thisauthor}}{#1}}

% raise the brackets in bibliography labels
\def\@biblabel#1{\def\citeauthoryear##1##2{##1, ##2}\@up{[}#1\@up{]}\hfill}

\def\@up#1{\leavevmode\raise.2ex\hbox{#1}}
\makeatother




%
%


% --- Custom commands for metadata ---
\newcommand{\thetitle}{}
\newcommand{\theauthor}{}
\newcommand{\thedate}{}

\renewcommand{\title}[1]{\renewcommand{\thetitle}{#1}}
\renewcommand{\author}[1]{\renewcommand{\theauthor}{#1}}
\renewcommand{\date}[1]{\renewcommand{\thedate}{#1}}

% --- Miscellaneous tweaks ---
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

% ------------------------------------------------------------------
% Hilbert-style proof environment with header
% ------------------------------------------------------------------
\usepackage{proof}
\newcounter{proofHstep}

% \begin{proofH}[<heading>] … \end{proofH}
% Optional argument lets you override the heading if you need to:
%   \begin{proofH}[Sketch] … \end{proofH}
\newenvironment{proofH}[1][Proof]{%
  \par\smallskip\noindent\textit{#1.\\}  % “Proof.” by default
  \setcounter{proofHstep}{0}%
  \ignorespaces
}{%
  \par\smallskip\qed
}

% \Hstep[<rule>]{<formula>}
\newcommand{\Hstep}[2][]{%
  \refstepcounter{proofHstep}%
  \noindent\makebox[2.1em][r]{\bfseries\arabic{proofHstep}.}\,
  $#2$%
  \ifstrempty{#1}{}{%
    \hfill(\text{#1})%
  }%
  \par
}
\newcommand{\inferLeft}[3]{
\text{(#1)} \quad &
\begin{array}{c}
#2 \\
\hline
#3
\end{array}
}
% \newcommand{\inferLeft}[3]{%
%   \text{(#1)}\quad &%
%   \begin{array}[b]{c}%
%     #2\\\hline
%     #3%
%   \end{array}}

% ------------------------------------------------------------------
%  Useful
% ------------------------------------------------------------------
\newcommand{\pset}[1]{\mathfrak{P}({#1})}
\newcommand{\tiff}{\quad \text{if and only if}\quad}
\newcommand{\tand}{\quad \text{and} \quad}
\newcommand{\timpl}{\quad \text{implies} \quad}
\newcommand{\pin}{\mathcal{W}}
\newcommand{\Pin}{\mathcal{W} = \langle S,l,\prec \rangle}
\newcommand{\lang}{\mathcal{L}}
\newcommand{\Lang}{\mathcal{L}_+}
\newcommand{\Cn}[1]{\mathcal{C}n_{#1}}
