% thesis.sty – Custom style for Master's thesis
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{macros/thesis}[2025/03/30 Master's Thesis Style]

% --- Subfile support ---
\usepackage{subfiles}
\input{macros/formal-concept-analysis.tex}
\input{macros/general.tex}
\input{macros/fca.sty}

% --- Encoding and Language ---
% \usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{microtype}
\usepackage{dirtytalk}
\usepackage{csquotes}

% \RequirePackage{fontspec} % Ensure fontspec is loaded first
\RequirePackage{stix2}    % This loads unicode-math and sets STIX Two fonts for math and text
\usepackage[scaled=0.9]{inconsolata}   % or \usepackage[scale=0.85]{inconsolata}

% --- Geometry and Spacing ---
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{setspace}
\setstretch{1.35}
\RequirePackage{fancyhdr}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter\ : #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ : #1}}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[EL]{\small Section \rightmark}    % current SECTION on the left
\fancyhead[ER]{\small \thepage}      % page number on the right
\fancyhead[OL]{\small \thepage}      % page number on the left
\fancyhead[OR]{\small Chapter \leftmark}     % current CHAPTER on the right
\fancyfoot{}                  % no footers
\renewcommand{\headrulewidth}{0.4pt}   % keep or adjust
\fancypagestyle{plain}{        % redefine the 'plain' pagestyle
  \fancyhf{}                   % clear header and footer
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
\usepackage{enumitem}
\setlist[itemize]{itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt}
\setlist[enumerate]{itemsep=0pt,parsep=0pt,topsep=0pt,partopsep=0pt}

% --- Math and theorem environments ---
\usepackage{amsmath,amsthm}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{nicefrac}
\usepackage{thmtools}
\usepackage{epigraph}
\everymath{\displaystyle}
\theoremstyle{definition}

% --- Theorem declarations ---
\usepackage{etoolbox}
\declaretheorem[style=plain]{theorem}
\newtheorem{example}{Example}
\AtEndEnvironment{example}{\par\addvspace{\baselineskip}}
\declaretheorem[style=definition]{definition}
\declaretheorem[style=remark]{remark}
\declaretheorem{lemma}
\declaretheorem{proposition}
\declaretheorem{corollary}

% --- Figures and floats ---
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{listings}
\usepackage[table,dvipsnames]{xcolor}
\usepackage{tikz}
\usetikzlibrary{positioning}

% --- Colours ---
\definecolor{light}{rgb}{0.77,0.1,0.541}
\definecolor{blue}{rgb}{0.255,0.714,0.769}
\definecolor{mediumblue}{rgb}{0.173,0.498,0.722}
\definecolor{darkblue}{rgb}{0.145,0.204,0.580}

% --- Hyperlinks ---
\usepackage[hidelinks]{hyperref}
\usepackage[nameinlink]{cleveref}
\usepackage{url}
\crefname{figure}{figure}{figures}
\Crefname{figure}{Figure}{Figures}
\crefname{subfigure}{subfigure}{subfigures}
\Crefname{subfigure}{Subfigure}{Subfigures}
\crefname{section}{section}{sections}
\Crefname{section}{Section}{Sections}
\crefname{subsection}{subsection}{Subsections}
\Crefname{subsection}{Subsection}{Subsections}
\Crefname{cxt}{Formal Context}{Formal Contexts}

% --- Bibliography ---
\usepackage{makeidx}
\makeindex
\usepackage{csquotes}
\usepackage[
  backend=bibtex,
  style=ieee,
  citestyle=numeric
]{biblatex}
\addbibresource{references.bib}

% --- Custom commands for metadata ---
\newcommand{\thetitle}{}
\newcommand{\theauthor}{}
\newcommand{\thedate}{}

\renewcommand{\title}[1]{\renewcommand{\thetitle}{#1}}
\renewcommand{\author}[1]{\renewcommand{\theauthor}{#1}}
\renewcommand{\date}[1]{\renewcommand{\thedate}{#1}}

% --- Miscellaneous tweaks ---
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{1}

% ------------------------------------------------------------------
% Hilbert-style proof environment with header
% ------------------------------------------------------------------
\usepackage{proof}
\newcounter{proofHstep}

% \begin{proofH}[<heading>] … \end{proofH}
% Optional argument lets you override the heading if you need to:
%   \begin{proofH}[Sketch] … \end{proofH}
\newenvironment{proofH}[1][Proof]{%
  \par\smallskip\noindent\textit{#1.\\}  % “Proof.” by default
  \setcounter{proofHstep}{0}%
  \ignorespaces
}{%
  \par\smallskip\qed
}

% \Hstep[<rule>]{<formula>}
\newcommand{\Hstep}[2][]{%
  \refstepcounter{proofHstep}%
  \noindent\makebox[2.1em][r]{\bfseries\arabic{proofHstep}.}\,
  $#2$%
  \ifstrempty{#1}{}{%
    \hfill(\text{#1})%
  }%
  \par
}
\newcommand{\inferLeft}[3]{
\text{(#1)} \quad &
\begin{array}{c}
#2 \\
\hline
#3
\end{array}
}
% \newcommand{\inferLeft}[3]{%
%   \text{(#1)}\quad &%
%   \begin{array}[b]{c}%
%     #2\\\hline
%     #3%
%   \end{array}}

% ------------------------------------------------------------------
%  Useful
% ------------------------------------------------------------------
\newcommand{\pset}[1]{2^{#1}}
